#!/bin/bash

# Script de setup Netlify pour ProjectBot
# √Ä lancer une fois apr√®s: netlify login

echo "üöÄ Configuration Netlify pour ProjectBot..."

# V√©rifier que l'utilisateur est connect√©
if ! netlify status &> /dev/null; then
    echo "‚ùå Vous devez d'abord vous connecter avec: netlify login"
    exit 1
fi

echo "‚úÖ Connect√© √† Netlify"

# Lier le site si n√©cessaire
echo ""
echo "Liaison du site √† Netlify..."
netlify link --silent 2>/dev/null || netlify link

echo ""
echo "üìù Configuration des variables d'environnement..."

# Fonction pour demander et setter une variable
set_env_var() {
    local var_name=$1
    local var_description=$2

    read -p "üìå Entrez la valeur pour $var_description ($var_name): " var_value

    if [ ! -z "$var_value" ]; then
        netlify env:set $var_name "$var_value"
        echo "‚úÖ $var_name d√©fini"
    else
        echo "‚è≠Ô∏è  $var_name ignor√©"
    fi
    echo ""
}

# Variables obligatoires
set_env_var "GITHUB_TOKEN" "GitHub Personal Access Token (avec permission repo)"
set_env_var "GITHUB_REPO_OWNER" "Propri√©taire du repo GitHub (ex: ProjectView)"
set_env_var "GITHUB_REPO_NAME" "Nom du repo GitHub (ex: site-projectview)"

echo ""
echo "Variables optionnelles:"
echo ""

# Variables optionnelles
set_env_var "GOOGLE_SHEETS_API_KEY" "Google Sheets API Key (optionnel)"
set_env_var "GOOGLE_SHEETS_SPREADSHEET_ID" "Google Sheets Spreadsheet ID (optionnel)"
set_env_var "TELEGRAM_BOT_TOKEN" "Telegram Bot Token (optionnel)"
set_env_var "TELEGRAM_CHAT_ID" "Telegram Chat ID (optionnel)"

echo ""
echo "‚úÖ Configuration termin√©e!"
echo ""
echo "Variables d√©finies:"
netlify env:list

echo ""
echo "üéâ Tu peux maintenant publier des articles via N8N!"
